"use strict";(self.webpackChunkc=self.webpackChunkc||[]).push([[365],{1365:(e,t,s)=>{s.r(t),s.d(t,{openSettingsPopup:()=>I});var n=s(5893),r=s(4047),c=s(6764),l=s(9391),i=s(9545),a=s(7006),o=s(9670),d=s(173);function h(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Аккаунт"}),(0,n.jsx)(x,{})]})})}function x(){const e=(0,o.k)(3);return(0,i.SZ)(e),e.hasLogged?(0,n.jsxs)(l.z,{onClick:t=>(0,a.j)(t,r.oC,(t=>(0,n.jsxs)(d.Qb,{onClick:t,children:[(0,n.jsx)(d.HC,{onClick:()=>e.updateUser(),children:"Обновить"}),(0,n.jsx)(d.HC,{onClick:()=>e.logout(),children:"Выйти"}),(0,n.jsx)(d.HC,{onClick:()=>e.logoutAll(),children:"Завершить все сессии"})]}))),children:[(0,n.jsx)("div",{className:"soc",children:"twitch"}),e.username]}):(0,n.jsxs)(l.z,{onClick:()=>e.authTwitch(),children:[(0,n.jsx)("div",{className:"soc",children:"twitch"}),"Войти"]})}var j=s(9917);class u{static delete(e){return(0,j.h)("storage",(t=>t.delete(e)))}static update(e,t){return(0,j.h)("storage",(s=>s.put(t,e)))}static get(e){return(0,j.h)("storage",(t=>t.get(e)))}}var p=s(7294),g=s(4444),k=s(2397);const m=1,f=["pastas","emotes","tags"];function v(e,t){let[s,n,r]=t?[e.lastExportPastaId??0,e.lastExportEmoteAdded??0,e.lastExportTagId??0]:[0,0,0];return new Promise(((e,c)=>{const l=(0,j.q)().transaction(f,"readonly");let i;l.objectStore("pastas").getAll(IDBKeyRange.lowerBound(s,!0)).onsuccess=function(){i=(0,k.Xz)(this.result)};let a=[];l.objectStore("emotes").openCursor(IDBKeyRange.lowerBound(n,!0)).onsuccess=function(){const e=this.result;e&&(n=e.key,a.push(e.value),e.continue())};let o=[];l.objectStore("tags").openCursor(IDBKeyRange.lowerBound(r,!0)).onsuccess=function(){const e=this.result;e&&(r=e.key,o.push(e.value),e.continue())},l.oncomplete=()=>{const s=Date.now();a=(0,k.Xz)(a),o=(0,k.Xz)(o);const c={stores:{pastas:i,emotes:a,tags:o},meta:{version:m,date:s,isPartial:t}},l=URL.createObjectURL(new Blob([JSON.stringify(c)],{type:"plain/text"}));(0,g.LR)(l,"copypastas_"+(new Date).toLocaleString()+".json");const d={lastExportDate:s};i&&(d.lastExportPastaId=i[i.length-1].id),a&&(d.lastExportEmoteAdded=n),o&&(d.lastExportTagId=r),e(d)},l.onerror=c}))}var C=s(1426);function w({type:e,name:t,source:s}){return`${e}:::${t}:::${s}`}function y(){return(0,g.ep)(!1).then((e=>e.item(0).text())).then((e=>JSON.parse(e))).then((e=>function(e){let t=e;for(let t=e.meta.version;t<m;t++)t+1;return t}(e))).then((e=>new Promise((async(t,s)=>{const{meta:n,stores:c}=e,l=new Set;for(let e of await(0,j.h)("emotes",(e=>e.getAll())))l.add(w(e));const i=(0,j.q)().transaction(f,"readwrite");if(c.pastas){const e=i.objectStore("pastas");for(let t of c.pastas)e.add(t)}if(c.emotes){const e=i.objectStore("emotes");for(let t of c.emotes)l.has(w(t))||e.add(t)}i.oncomplete=()=>{(0,r.E)("Выполнено"),t({lastExportDate:Date.now()})},i.onerror=s})))).catch(C.d9)}function E(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Импорт и экспорт"}),(0,n.jsx)("p",{children:'Не забывайте периодически экспортировать данные, браузер может посчитать, что данные, сохраняемые сайтом, не имеют ценности. Проблема решается, если браузер защитит хранилище от удаления. Для Firefox - нажать "сохранять данные" во всплывающем окне. Для остальных всё неоднозначно, поэтому стоит добавить сайт в закладки и установить на главный экран.'}),(0,n.jsx)(l.z,{onClick:()=>{(0,r.EB)((()=>(0,n.jsx)(z,{})))},children:"Импорт и экспорт"})]})})}function z(){const[e,t]=(0,p.useState)({});function s(s){const n={...e,...s};u.update("backup",n),(0,o.k)(0).getModel("favs").updatePage({withTags:!0,withTotal:!0}),t(n)}(0,p.useEffect)((()=>{u.get("backup").then((e=>e&&t(e)))}),[]);const{lastExportDate:c}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Импорт и экспорт"}),(0,n.jsxs)("p",{children:["Экспорт и импорт позволяет",":"]}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["Экспортировать пасты и переносить их в другие браузеры и устройства",";"]}),(0,n.jsxs)("li",{children:["Создавать резервные копии локальной базы данных","."]})]}),c&&(0,n.jsxs)("p",{children:["Время последнего экспорта или импорта: ",(0,n.jsx)("b",{children:new Date(c).toLocaleString()})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Полный экспорт"}),(0,n.jsx)("p",{children:"Полный экспорт локальной базы данных."}),(0,n.jsx)(l.z,{onClick:()=>v(e,!1).then(s),children:"Полный экспорт"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Импорт"}),(0,n.jsx)("p",{children:"Импорт экспортированных данных в существующую базу данных, все импортируемые пасты, эмоджи, теги и.т.д будут добавлены как новые."}),(0,n.jsx)(l.z,{onClick:()=>y().then(s),children:"Импорт"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Частичный экспорт"}),(0,n.jsx)("p",{children:"Будут экспортированы только данные, добавленные после последнего экспорта или импорта. Можно использовать для синхронизации данных между устройствами и браузерами."}),(0,n.jsx)(l.z,{onClick:()=>v(e,!0).then(s),children:"Частичный экспорт"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Очистить локальное хранилище"}),(0,n.jsx)("p",{children:"Очистка соответствующего раздела локальной базы данных."}),(0,n.jsx)("p",{children:(0,n.jsx)(l.z,{onClick:()=>(0,r.FW)("Очистить локальное хранилище").then((()=>(0,o.k)(1).clear().then((()=>(0,o.k)(0).updateLayer("favs"))))),children:"Удалить все копипасты"})}),(0,n.jsx)("p",{children:(0,n.jsx)(l.z,{onClick:()=>(0,r.FW)("Удалить все копипасты").then((()=>(0,o.k)(5).clear().then((()=>(0,o.k)(0).updateLayer("favs"))).then((()=>(0,o.k)(0).updateLayer("global"))))),children:"Удалить все эмоуты"})}),(0,n.jsx)("p",{children:(0,n.jsx)(l.z,{onClick:()=>(0,r.FW)("Удалить все эмоуты").then((()=>(0,o.k)(4).clear().then((()=>(0,o.k)(0).updateLayer("favs"))).then((()=>(0,o.k)(0).updateLayer("global"))))),children:"Удалить все теги"})})]})]})}var S=s(1611),b=s(4639),D=s(5732),B=s(2793);function L(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Теги"}),(0,n.jsx)("p",{children:"Настройка тегов"}),(0,n.jsx)(l.z,{onClick:()=>{(0,r.EB)((()=>(0,n.jsx)(F,{})))},children:"Теги"})]})})}function F(){const e=(0,o.k)(4);return(0,i.SZ)(e),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Теги"}),(0,n.jsx)("p",{children:"Настройка тегов позволяет добавить к тегу кастомные изображения, эмоджи"})]}),(0,n.jsx)(l.z,{onClick:()=>(0,r.EB)(((e,t)=>p.createElement((()=>{const[s,r]=(0,p.useState)(""),[c,i]=(0,p.useState)(),a=()=>{if(0===s.length||!c||(0,o.k)(4).test(s))return(0,C.d9)();e({name:s,source:c.source,type:c.type})};return(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Новый тег"}),(0,n.jsxs)("div",{className:B.Z.gColumn,children:[(0,n.jsx)(b.I,{value:s,onChange:r,placeholder:"Тег"}),(0,n.jsxs)(d.HC,{children:[(0,n.jsx)("div",{children:(c?"":"Иконка")+(c&&s.length?"":" + ")+(s.length?s:"Тег")}),c&&(0,n.jsx)(D.A0,{...c}),c&&(0,n.jsx)(l.z,{className:"ic",selected:!0,onClick:()=>i(void 0),children:"delete"})]}),(0,n.jsx)(S.ih,{handler:i}),(0,n.jsxs)("div",{className:B.Z.gInline,children:[(0,n.jsx)(l.z,{onClick:a,children:"Добавить"}),(0,n.jsx)(l.z,{onClick:t,children:"Отменить"})]})]})]})})))).then((e=>(0,o.k)(4).add(e))),children:"Добавить"}),(0,n.jsxs)(d.aV,{children:[0===e.getData().length&&(0,n.jsx)("div",{className:B.Z.gEmptyContainer,children:"Пусто"}),e.getData().map((t=>(0,n.jsxs)(d.HC,{children:[(0,n.jsx)("div",{children:t.name}),(0,n.jsx)(D.A0,{...t}),(0,n.jsx)(l.z,{className:"ic",onClick:()=>e.delete(t.name),children:"delete"})]},t.name)))]})]})}function I(){return(0,c.k)("open_settings"),(0,r.EB)(((e,t)=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsx)("h1",{children:"Настройки"})}),(0,n.jsx)(h,{}),(0,n.jsx)(E,{}),(0,n.jsx)(L,{})]})))}}}]);