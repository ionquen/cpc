"use strict";(self.webpackChunkc=self.webpackChunkc||[]).push([[646],{2646:(e,t,n)=>{n.r(t),n.d(t,{SlateEditor:()=>M,default:()=>R});var s=n(5893),r=n(7294),i=n(3146),o=n(7553);const c="LJZSZ",a="D0y5t",l="_7PbVH",f="ybGTI",u="ZnKhz";var d=n(6026),h=n(5732);const p={insertEmote(e,t,n=e.selection){if(6===t.type)return e.insertText(t.source+" ");const s={type:"e",data:t,children:[{text:""}]};i.YR.insertNodes(e,s,{at:n,select:!0});const r=i.ML.next(e);r&&i.YR.select(e,{path:r[1],offset:0})}};var x=n(1611),m=n(7615);function y({element:e,attributes:t,children:n}){return(0,s.jsx)("div",{...t,className:a,children:n})}function j({element:e,attributes:t,children:n}){const{data:r}=e,i=(0,o.vt)();return(0,s.jsxs)("span",{...t,className:(0,m.cn)(i&&f),children:[(0,s.jsx)(h.A0,{...r,label:!0}),n,r?.name&&(0,s.jsx)("span",{className:u,children:(0,s.jsx)("span",{children:r.name})})]})}const v=e=>"e"===e.element.type?(0,s.jsx)(j,{...e}):(0,s.jsx)(y,{...e}),E=({attributes:e,children:t,leaf:n})=>{const{emotes:r}=n;return r?(0,s.jsxs)("span",{...e,className:l,children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)(N,{name:r.code,range:r.range})]}):(0,s.jsx)("span",{...e,children:t})};function N({name:e,range:t}){const n=(0,o._7)(),[i,c]=(0,r.useState)([]);return(0,r.useEffect)((()=>{(0,h.zZ)(e).then(c)}),[]),(0,s.jsx)("div",{contentEditable:!1,className:d.Z.label,"data-label-pos":"3",children:i.map(((e,r)=>(0,s.jsxs)("div",{onClick:()=>p.insertEmote(n,e,t),children:[(0,s.jsx)(h.A0,{...e}),(0,x.Ah)(e.type)]},r)))})}var b=n(1688);function g(){return function(e){const{normalizeNode:t,isVoid:n,isInline:s}=e;return e.normalizeNode=n=>{t(n),function(e,t){[k,C,w,z].forEach((n=>n(e,t)))}(e,n)},e.isVoid=e=>"e"===e.type||n(e),e.isInline=e=>"e"===e.type||s(e),e}((0,o.BU)((0,b.VC)((0,i.Jh)())))}function k(e,[t,n]){if(i.W_.isElement(t)&&"p"===t.type)for(const[t,s]of i.NB.children(e,n))if(i.W_.isElement(t)&&!e.isInline(t))return void i.YR.unwrapNodes(e,{at:s})}function C(e,[t,n]){if(!i.xv.isText(t))return;const[s,r]=i.ML.parent(e,n);"p"!==s.type&&i.YR.wrapNodes(e,{type:"p"},{at:n})}function w(e,[t,n]){if(!i.W_.isElement(t)||"e"!==t.type)return;const[s,r]=i.ML.parent(e,n);"p"!==s.type&&i.YR.wrapNodes(e,{type:"p"},{at:n})}function z(e,[t,n]){if(!i.xv.isText(t))return;const s=A(t.text);for(let t of s){if(!(0,h.AE)(t[0]))continue;const s=e?.selection?.focus;if(!(s&&i.y$.equals(s.path,n)&&s.offset>t.index&&s.offset<=t.index+t[0].length))return void(0,h.zZ)(t[0]).then((([s])=>{6!==s.type&&p.insertEmote(e,s,{anchor:{path:n,offset:t.index},focus:{path:n,offset:t.index+t[0].length}})}))}}function A(e){return e.matchAll(/(\S+)/gim)}function L(e){return([t,n])=>{const s=[];for(let r of[V])s.push(...r([t,n],e));return s}}const V=([e,t],n)=>{if(!(i.xv.isText(e)&&n.selection&&i.y$.equals(n.selection.anchor.path,n.selection.focus.path)&&i.e6.includes(n.selection,t)))return[];const s=A(e.text);let r;for(let e of s)if(e.index<n.selection.focus.offset&&e.index+e[0].length+1>n.selection.focus.offset){r=e;break}if(!r)return[];if(!(0,h.AE)(r[0]))return[];const o={anchor:{path:t,offset:r.index},focus:{path:t,offset:r.index+r[0].length}};return[{...o,emotes:{code:r[0],range:o}}]};var Z=n(9670);const M=(0,r.memo)((({initValue:e,onChange:t,...n})=>{const a=(0,r.useMemo)((()=>{const t=g();return t.children=[{type:"p",children:e??[{text:""}]}],i.ML.normalize(t,{force:!0}),t}),[]);return(0,s.jsxs)("div",{className:c,children:[(0,s.jsx)(o.mH,{editor:a,initialValue:a.children,onChange:t,children:(0,s.jsx)(o.CX,{...n,decorate:L(a),renderLeaf:E,renderElement:v,spellCheck:!0,onFocus:()=>{(0,Z.k)(5).preloadNames()},onKeyDown:e=>{if(e.ctrlKey)switch(e.key){case"я":case"z":e.preventDefault(),e.shiftKey?a.redo():a.undo()}}})}),(0,s.jsx)(x.ih,{handler:(0,r.useCallback)((e=>p.insertEmote(a,e)),[a])})]})})),R=M}}]);